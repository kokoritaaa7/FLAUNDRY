{% extends 'base.html' %}
{% load static %}
{% block contents %}
<style>
  .customoverlay {
    position: relative;
    bottom: 85px;
    border-radius: 6px;
    border: 1px solid #ccc;
    border-bottom: 2px solid #ddd;
    float: left;
  }
  .near_marker {
    background-color : skyblue;
    border-radius : 10px
  }

  .customoverlay:nth-of-type(n) {
    border: 0;
    box-shadow: 0px 1px 2px #888;
  }

  .customoverlay a {
    display: block;
    text-decoration: none;
    color: #000;
    text-align: center;
    border-radius: 6px;
    font-size: 14px;
    font-weight: bold;
    overflow: hidden;
    background: #d95050;
    background: #d95050 url(https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/arrow_white.png) no-repeat right 14px center;
  }

  .customoverlay .title {
    display: block;
    text-align: center;
    background: #fff;
    margin-right: 35px;
    padding: 10px 15px;
    font-size: 14px;
    font-weight: bold;
  }

  .customoverlay:after {
    content: '';
    position: absolute;
    margin-left: -12px;
    left: 50%;
    bottom: -12px;
    width: 22px;
    height: 12px;
    background: url('https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/vertex_white.png')
  }
</style>

<style>
  .slider {}
</style>
<div class="row" data-gutter="none">
  <div class="col-md-2 ">
    <div class="theme-search-results-sidebar afternav-height theme-search-results-map-layout-block">
      <a class="theme-search-results-map-layout-btn" href="{% url 'board:main' %}">
        <i class="fa fa-list" ></i>뒤로 가기
      </a>
      <!-- 왼쪽 네비게이션 -->
      <div class="theme-search-results-sidebar-sections theme-search-results-sidebar-sections-white-wrap">
        <div class="theme-search-results-sidebar-section">
          <h5 class="theme-search-results-sidebar-section-title">세탁소 찾기</h5>
          <div class="theme-search-results-sidebar-section-search">
            <input class="theme-search-results-sidebar-section-search-input" id="searchAddress" type="text"
              placeholder="주소를 입력하세요." />
            <!-- <a class="fa fa-search theme-search-results-sidebar-section-search-btn" href="{% url 'laundry:search_map2' %}" ></a> -->
            <a class="fa fa-search theme-search-results-sidebar-section-search-btn" onclick="sendaddress()" ></a>
          </div>
        </div>
        <div class="theme-search-results-sidebar-section">
          <h5 class="theme-search-results-sidebar-section-title">가격 범위</h5>
          <div class="theme-search-results-sidebar-section-price slider">
            <input id="price-slider" name="price-slider" data-min="4000" data-max="5000" />
          </div>
        </div>
        <div class="theme-search-results-sidebar-section">
          <h5 class="theme-search-results-sidebar-section-title">세탁기/건조기 용량</h5>
          <div class="theme-search-results-sidebar-section-checkbox-list">
            <div class="theme-search-results-sidebar-section-checkbox-list-items">
              <div class="checkbox theme-search-results-sidebar-section-checkbox-list-item">
                <label class="icheck-label">
                  <input class="icheck" type="checkbox" />
                  <span class="icheck-title">소 ( ~ 20kg )</span>
                </label>
              </div>
              <div class="checkbox theme-search-results-sidebar-section-checkbox-list-item">
                <label class="icheck-label">
                  <input class="icheck" type="checkbox" />
                  <span class="icheck-title">중 ( 20 ~ 26kg )</span>
                </label>
              </div>
              <div class="checkbox theme-search-results-sidebar-section-checkbox-list-item">
                <label class="icheck-label">
                  <input class="icheck" type="checkbox" />
                  <span class="icheck-title">대 ( 27 ~ 30kg )</span>
                </label>
              </div>
              <div class="checkbox theme-search-results-sidebar-section-checkbox-list-item">
                <label class="icheck-label">
                  <input class="icheck" type="checkbox" />
                  <span class="icheck-title">특대 ( 30kg ~ )</span>
                </label>
              </div>
            </div>
          </div>
        </div>
        <div class="theme-search-results-sidebar-section">
          <h5 class="theme-search-results-sidebar-section-title">세탁 기능</h5>
          <div class="theme-search-results-sidebar-section-checkbox-list">
            <div class="theme-search-results-sidebar-section-checkbox-list-items">
              <div class="checkbox theme-search-results-sidebar-section-checkbox-list-item">
                <label class="icheck-label">
                  <input class="icheck" type="checkbox" />
                  <span class="icheck-title">쾌속세탁</span>
                </label>
              </div>
              <div class="checkbox theme-search-results-sidebar-section-checkbox-list-item">
                <label class="icheck-label">
                  <input class="icheck" type="checkbox" />
                  <span class="icheck-title">향균세탁</span>
                </label>
              </div>
              <div class="checkbox theme-search-results-sidebar-section-checkbox-list-item">
                <label class="icheck-label">
                  <input class="icheck" type="checkbox" />
                  <span class="icheck-title">산소계 세탁</span>
                </label>
              </div>
              <div class="checkbox theme-search-results-sidebar-section-checkbox-list-item">
                <label class="icheck-label">
                  <input class="icheck" type="checkbox" />
                  <span class="icheck-title">아웃도어 세탁</span>
                </label>
              </div>
              <div class="checkbox theme-search-results-sidebar-section-checkbox-list-item">
                <label class="icheck-label">
                  <input class="icheck" type="checkbox" />
                  <span class="icheck-title">프리미엄 세탁</span>
                </label>
              </div>
              <div class="checkbox theme-search-results-sidebar-section-checkbox-list-item">
                <label class="icheck-label">
                  <input class="icheck" type="checkbox" />
                  <span class="icheck-title">이불 세탁</span>
                </label>
              </div>
            </div>
          </div>
        </div>
        <div class="theme-search-results-sidebar-section">
          <h5 class="theme-search-results-sidebar-section-title">건조기 가격 범위</h5>
          <div class="theme-search-results-sidebar-section-price">
            <input id="price-slider" name="price-slider" data-min="100" data-max="500" />
          </div>
        </div>
        <div class="theme-search-results-sidebar-section">
          <h5 class="theme-search-results-sidebar-section-title">건조기 기능</h5>
          <div class="theme-search-results-sidebar-section-checkbox-list">
            <div class="theme-search-results-sidebar-section-checkbox-list-items">
              <div class="checkbox theme-search-results-sidebar-section-checkbox-list-item">
                <label class="icheck-label">
                  <input class="icheck" type="checkbox" />
                  <span class="icheck-title">고온</span>
                </label>
              </div>
              <div class="checkbox theme-search-results-sidebar-section-checkbox-list-item">
                <label class="icheck-label">
                  <input class="icheck" type="checkbox" />
                  <span class="icheck-title">중온</span>
                </label>
              </div>
              <div class="checkbox theme-search-results-sidebar-section-checkbox-list-item">
                <label class="icheck-label">
                  <input class="icheck" type="checkbox" />
                  <span class="icheck-title">저온</span>
                </label>
              </div>
            </div>
          </div>
        </div>
        <div class="theme-search-results-sidebar-section">
          <h5 class="theme-search-results-sidebar-section-title">편의시설</h5>
          <div class="theme-search-results-sidebar-section-checkbox-list">
            <div class="theme-search-results-sidebar-section-checkbox-list-items">
              <div class="checkbox theme-search-results-sidebar-section-checkbox-list-item">
                <label class="icheck-label">
                  <input class="icheck" type="checkbox" />
                  <span class="icheck-title">Wi-Fi</span>
                </label>
              </div>
              <div class="checkbox theme-search-results-sidebar-section-checkbox-list-item">
                <label class="icheck-label">
                  <input class="icheck" type="checkbox" />
                  <span class="icheck-title">빨래바구니/카트</span>
                </label>
              </div>
              <div class="checkbox theme-search-results-sidebar-section-checkbox-list-item">
                <label class="icheck-label">
                  <input class="icheck" type="checkbox" />
                  <span class="icheck-title">커피머신</span>
                </label>
              </div>
              <div class="checkbox theme-search-results-sidebar-section-checkbox-list-item">
                <label class="icheck-label">
                  <input class="icheck" type="checkbox" />
                  <span class="icheck-title">에어컨</span>
                </label>
              </div>
            </div>
            <div class="collapse" id="SearchResultsCheckboxNeighborhoods">
              <div
                class="theme-search-results-sidebar-section-checkbox-list-items theme-search-results-sidebar-section-checkbox-list-items-expand">
                <div class="checkbox theme-search-results-sidebar-section-checkbox-list-item">
                  <label class="icheck-label">
                    <input class="icheck" type="checkbox" />
                    <span class="icheck-title">공기청정기</span>
                  </label>
                </div>
                <div class="checkbox theme-search-results-sidebar-section-checkbox-list-item">
                  <label class="icheck-label">
                    <input class="icheck" type="checkbox" />
                    <span class="icheck-title">무인 보관함</span>
                  </label>
                </div>
                <div class="checkbox theme-search-results-sidebar-section-checkbox-list-item">
                  <label class="icheck-label">
                    <input class="icheck" type="checkbox" />
                    <span class="icheck-title">핸드폰 충전기</span>
                  </label>
                </div>
                <div class="checkbox theme-search-results-sidebar-section-checkbox-list-item">
                  <label class="icheck-label">
                    <input class="icheck" type="checkbox" />
                    <span class="icheck-title">정수기</span>
                  </label>
                </div>
              </div>
            </div>
            <a class="theme-search-results-sidebar-section-checkbox-list-expand-link" role="button"
              data-toggle="collapse" href="#SearchResultsCheckboxNeighborhoods" aria-expanded="false">더보기
              <i class="fa fa-angle-down"></i>
            </a>
          </div>
        </div>
        <div class="theme-search-results-sidebar-section">
          <h5 class="theme-search-results-sidebar-section-title">세탁용품</h5>
          <div class="theme-search-results-sidebar-section-checkbox-list">
            <div class="theme-search-results-sidebar-section-checkbox-list-items">
              <div class="checkbox theme-search-results-sidebar-section-checkbox-list-item">
                <label class="icheck-label">
                  <input class="icheck" type="checkbox" />
                  <span class="icheck-title">대형 세탁봉투</span>
                </label>
              </div>
              <div class="checkbox theme-search-results-sidebar-section-checkbox-list-item">
                <label class="icheck-label">
                  <input class="icheck" type="checkbox" />
                  <span class="icheck-title">중형 세탁봉투</span>
                </label>
              </div>
              <div class="checkbox theme-search-results-sidebar-section-checkbox-list-item">
                <label class="icheck-label">
                  <input class="icheck" type="checkbox" />
                  <span class="icheck-title">소형 세탁봉투</span>
                </label>
              </div>
              <div class="checkbox theme-search-results-sidebar-section-checkbox-list-item">
                <label class="icheck-label">
                  <input class="icheck" type="checkbox" />
                  <span class="icheck-title">건조기용 연유제</span>
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>


  <!-- 파라미터 받기 & 전달 -->
  <script>
    let getLink = window.location.search;
    let getKeyword = getLink.split("=");
    let getOnlyKeyword = decodeURI(getKeyword[1]);
    console.log(decodeURI(getOnlyKeyword));
    
    function sendaddress(){
      let userKeyword = $('#searchAddress').val();
      console.log(userKeyword)
      window.location.href = "/laundry/search_map2?keyword=" + userKeyword;
      $.ajax({
        url: '/search_map2/',
        data: { },
        success: function(res) {
          console.log("ajax success!")
          console.log(res)
          for(var i = 0; i < res.length; i++) {
            var marker = new kakao.maps.Marker({
              map : map, // 마커를 표시할 지도
              position : new kakao.maps.LatLng(res[i].lat, res[i].lng),
              title : res[i].title,
            });
          }
        },
        error: function(res) {
          console.log("ajax failㅠㅠ")
        }
      });
    }
  </script>

  <!-- Kakao 지도 -->
  <div class="col-md-7">
    <!-- <div class="google-map afternav-" data-lat="37.480493156957195" data-lng="126.88203657182483" data-tab="false" data-markers="[{&quot;lat&quot;:37.480493156957195, &quot;lng&quot;:126.88203657182483},{&quot;lat&quot;:40.7474866, &quot;lng&quot;:-73.9738271},{&quot;lat&quot;:40.7230922, &quot;lng&quot;:-73.9829507},{&quot;lat&quot;:40.7519158, &quot;lng&quot;:-73.9853706},{&quot;lat&quot;:40.7533931, &quot;lng&quot;:-73.9743271},{&quot;lat&quot;:40.7554215, &quot;lng&quot;:-73.9922101},{&quot;lat&quot;:40.7612918, &quot;lng&quot;:-73.9770911},{&quot;lat&quot;:40.7643435, &quot;lng&quot;:-73.9700917},{&quot;lat&quot;:40.7496653, &quot;lng&quot;:-73.9797861},{&quot;lat&quot;:40.7386196, &quot;lng&quot;:-73.9770993},{&quot;lat&quot;:40.7229431, &quot;lng&quot;:-73.9978656},{&quot;lat&quot;:40.7254320, &quot;lng&quot;:-73.9704945},{&quot;lat&quot;:40.7602955, &quot;lng&quot;:-73.9969660},{&quot;lat&quot;:40.7438255, &quot;lng&quot;:-73.9908748},{&quot;lat&quot;:40.7629856, &quot;lng&quot;:-73.9928638},{&quot;lat&quot;:40.7611969, &quot;lng&quot;:-73.9928303},{&quot;lat&quot;:40.7614115, &quot;lng&quot;:-73.9971834},{&quot;lat&quot;:40.7380430, &quot;lng&quot;:-73.9899799},{&quot;lat&quot;:40.7580193, &quot;lng&quot;:-73.9897200},{&quot;lat&quot;:40.7461372, &quot;lng&quot;:-73.9743702},{&quot;lat&quot;:40.7399381, &quot;lng&quot;:-73.9945709},{&quot;lat&quot;:40.7386127, &quot;lng&quot;:-73.9836052},{&quot;lat&quot;:40.7366742, &quot;lng&quot;:-73.9810238},{&quot;lat&quot;:40.7406108, &quot;lng&quot;:-73.9986284},{&quot;lat&quot;:40.7276237, &quot;lng&quot;:-73.9739874},{&quot;lat&quot;:40.7325991, &quot;lng&quot;:-73.9703293},{&quot;lat&quot;:40.7364058, &quot;lng&quot;:-73.9718276},{&quot;lat&quot;:40.7644131, &quot;lng&quot;:-73.9856171},{&quot;lat&quot;:40.7584221, &quot;lng&quot;:-73.9857721},{&quot;lat&quot;:40.7233408, &quot;lng&quot;:-73.9822051},{&quot;lat&quot;:40.7431423, &quot;lng&quot;:-73.9711974},{&quot;lat&quot;:40.7220885, &quot;lng&quot;:-73.9923809},{&quot;lat&quot;:40.7327413, &quot;lng&quot;:-73.9723590},{&quot;lat&quot;:40.7676120, &quot;lng&quot;:-73.9973518},{&quot;lat&quot;:40.7334435, &quot;lng&quot;:-73.9914606},{&quot;lat&quot;:40.7403503, &quot;lng&quot;:-73.9826807},{&quot;lat&quot;:40.7672736, &quot;lng&quot;:-73.9810396},{&quot;lat&quot;:40.7349049, &quot;lng&quot;:-73.9872499},{&quot;lat&quot;:40.7550110, &quot;lng&quot;:-73.9793010},{&quot;lat&quot;:40.7351654, &quot;lng&quot;:-73.9882275},{&quot;lat&quot;:40.7308202, &quot;lng&quot;:-73.9958609},{&quot;lat&quot;:40.7485094, &quot;lng&quot;:-73.9822886},{&quot;lat&quot;:40.7496490, &quot;lng&quot;:-73.9745107},{&quot;lat&quot;:40.7263789, &quot;lng&quot;:-73.9987073},{&quot;lat&quot;:40.7205700, &quot;lng&quot;:-73.9722743},{&quot;lat&quot;:40.7373346, &quot;lng&quot;:-73.9985078},{&quot;lat&quot;:40.7494734, &quot;lng&quot;:-73.9753144},{&quot;lat&quot;:40.7668968, &quot;lng&quot;:-73.9892514},{&quot;lat&quot;:40.7234346, &quot;lng&quot;:-73.9832850},{&quot;lat&quot;:40.7361000, &quot;lng&quot;:-73.9944495},{&quot;lat&quot;:40.7600394, &quot;lng&quot;:-73.9967932},{&quot;lat&quot;:40.7303599, &quot;lng&quot;:-73.9830085},{&quot;lat&quot;:40.7618267, &quot;lng&quot;:-73.9723763},{&quot;lat&quot;:40.7211372, &quot;lng&quot;:-73.9999216},{&quot;lat&quot;:40.7225813, &quot;lng&quot;:-73.9816794},{&quot;lat&quot;:40.7395183, &quot;lng&quot;:-73.9742138},{&quot;lat&quot;:40.7515422, &quot;lng&quot;:-73.9751914},{&quot;lat&quot;:40.7660618, &quot;lng&quot;:-73.9880043},{&quot;lat&quot;:40.7341558, &quot;lng&quot;:-73.9966485},{&quot;lat&quot;:40.7270172, &quot;lng&quot;:-73.9745689}]"></!-->
    <div id="map" style="width:100%; height:700px;"></div>
    <script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=f56105d065f938ed8ae37254cd5c70ae"></script>
    <script>
      var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
        mapOption = { 
        center: new kakao.maps.LatLng({{user_center.lat}}, {{user_center.lng}}), // 지도의 중심좌표
        level: 3 // 지도의 확대 레벨
      };

      // 지도를 생성한다 
      var map = new kakao.maps.Map(mapContainer, mapOption);

      // 지도 타입 변경 컨트롤을 생성한다
      var mapTypeControl = new kakao.maps.MapTypeControl();

      // 지도의 상단 우측에 지도 타입 변경 컨트롤을 추가한다
      map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPRIGHT);

      // 지도에 확대 축소 컨트롤을 생성한다
      var zoomControl = new kakao.maps.ZoomControl();

      // 지도의 우측에 확대 축소 컨트롤을 추가한다
      map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);

      // 마커가 표시될 위치입니다 
      var markerPosition  = new kakao.maps.LatLng({{user_center.lat}}, {{user_center.lng}}); 
      
      // redMarker image setting
      var imgSrc = '{% static "img/redmarker.png" %}',
      imgSize = new kakao.maps.Size(30, 40),
      imgOption = {offset: new kakao.maps.Point(15, 45)}

      var redMarker = new kakao.maps.MarkerImage(imgSrc, imgSize, imgOption),
      redMarkerPosition = new kakao.maps.LatLng({{user_center.lat}}, {{user_center.lng}})

      
      // 마커를 생성합니다
      var marker = new kakao.maps.Marker({
        map: map,
        position: markerPosition,
        image: redMarker
      });

      // 마커가 지도 위에 표시되도록 설정합니다
      marker.setMap(map);

      var iwContent = '<div style="padding:5px;" text-align=center;>추천위치<br></div>', // 인포윈도우에 표출될 내용으로 HTML 문자열이나 document element가 가능합니다
          iwPosition = new kakao.maps.LatLng(33.450701,126.570667); //인포윈도우 표시 위치입니다

      // 인포윈도우를 생성합니다
      var infowindow = new kakao.maps.InfoWindow({
          position : iwPosition, 
          content : iwContent 
      });
        
      // 마커 위에 인포윈도우를 표시합니다. 두번째 파라미터인 marker를 넣어주지 않으면 지도 위에 표시됩니다
      infowindow.open(map, marker);

      $.ajax({
        url: '/marker_data/',
        data : {},
        success: function(res){
          for(let i=0; i< res.length; i++){
            let maker_position = new kakao.maps.LatLng(res[i].laundry_lat, res[i].laundry_lng)
            
            let laundry_marker = new kakao.maps.Marker({
              map:map,
              position : maker_position,
            });

            let page = res[i].laundry_page
            // 커스텀 오버레이에 표출될 내용으로 HTML 문자열이나 document element가 가능합니다
            var content = '<div class="customoverlay">' +
              `  <a href="https://map.kakao.com/link/map/${page}" target="_blank">` +
              '    <span class="title">' + res[i].laundry_name + '<br>' + 
              '세탁기 수 : ' + res[i].washer_cnt + ' 건조기 수 : ' + res[i].dryer_cnt + '</span>' +
              '  </a>' +
              '</div>';

            // 커스텀 오버레이를 생성합니다
            var customOverlay = new kakao.maps.CustomOverlay({
              map: map,
              position: maker_position,
              content: content,
              yAnchor: 1 
            });  
          }  
        }
      });

      // 지도 중심좌표를 접속위치로 변경합니다
      map.setCenter({{user_center.lat}}, {{user_center.lng}});

      // default image
      let defaultImg = '{% static "img/default_img.png" %}'
    </script>
  </div>

  <!-- 목록 부분 -->
  <div class="col-md-3">

    <div class="theme-search-results afternav-height theme-search-results-map-layout-block">
      <div class="theme-search-results-sort clearfix">
        <h5 class="theme-search-results-sort-title">목록</h5>
        <div class="dropdown theme-search-results-sort-alt">
          <a id="dropdownMenu" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"
            href="#">정렬 기준
            <span class="caret"></span>
          </a>
          <ul class="dropdown-menu" aria-labelledby="dropdownMenu">
            <li>
              <a href="#">거리순</a>
            </li>
            <li>
              <a href="#">별점순</a>
            </li>
            <li>
              <a href="#">리뷰순</a>
            </li>
          </ul>
        </div>
      </div>
      <div class="_mob-h">
        {% if laundry_list %}
        {% for laundry in laundry_list %}
        <div class="theme-search-results-item theme-search-results-item-sm">
          <a class="theme-search-results-item-mask-link" href="{% url 'laundry:detail_page' laundry.id %}"></a>
          <div class="row" data-gutter="10">
            <div class="col-xs-5 ">
              <div class="theme-search-results-item-img-wrap">
                {% comment %} <img class="theme-search-results-item-img" src="{{laundry.laundry_img|default:'https://jpninfo.com/wp-content/uploads/sites/6/2019/03/Screen-Shot-2019-03-28-at-14.24.35-e1553750715824.png'}}" alt="Image Alternative text"
                  title="Image Title" /> {% endcomment %}
                <img class="theme-search-results-item-img" src="{{laundry.laundry_img}}" onerror="this.src='https://jpninfo.com/wp-content/uploads/sites/6/2019/03/Screen-Shot-2019-03-28-at-14.24.35-e1553750715824.png'" alt="Image Alternative text"
                  title="Image Title" />
              </div>
            </div>
            <div class="col-xs-7 ">
              <h5 class="theme-search-results-item-title">{{ laundry.laundry_name }}</h5>
              {% if review %}
              <div class="theme-search-results-item-hotel-rating">
                <p class="theme-search-results-item-hotel-rating-title">
                  <b>{{ review.star }} </b>&nbsp;({{ review.num }})
                </p>
              </div>
              {% endif %}
              <div class="theme-search-results-item-price">
                <p class="theme-search-results-item-price-tag">가격 넣는 곳</p>
                <p class="theme-search-results-item-price-sign">30분/1회</p>
              </div>
            </div>
          </div>

        </div>
        {% endfor %}
        {% endif %}

      </div>

      <a class="theme-search-results-map-layout-btn" href="#">더보기</a>

    </div>

  </div>
</div>
{% endblock %}